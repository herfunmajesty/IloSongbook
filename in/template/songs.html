<!doctype html>

<html lang="en">
<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">

<link rel="icon" href="/images/icon.PNG" sizes="32x32" />
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

<title>Krakow Ukulele & Sing Tuesdays</title>
    
<style>
.highlight {background-color: lemonchiffon; font-weight: bold;}
.chord { font-weight: bold; color:red}
ul { list-style: none; padding-left: 0px; }
#options a {text-decoration: underline;}
#songs a {text-decoration: none;}
@import url('https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap');
.montserrat-h3 {
	font-family: 'Montserrat', sans-serif;
	font-weight: 300; /* Waga 300 odpowiada Montserrat Light */
}
.toggle-button {
	background-color: #eee;
	border: 3px solid #ccc;
	padding: 3px 5px;
	margin-right: 5px;
	cursor: pointer;
}
.bold-text {
    font-weight: bold;
    font-style: normal; 
	}
.italic-text {
	font-style: italic;
    font-weight: normal;
	}	
.ultra-light {
	font-family: 'Montserrat', sans-serif;
	font-weight: 200;
}

.semi-bold {
	font-family: 'Montserrat', sans-serif;
	font-weight: 600;
}
.custom-text-h5 {
			font-family: 'Montserrat', sans-serif;
			font-size: 1.2rem
}
.btn-filter-easy:active, .btn-filter-easy.active{
  color: black !important;
  background-color: #198754 !important;
  border-color: #198754 !important;
}
.btn-filter-easy:not(active){
  color: #198754 !important;
}
.btn-filter-medium:active, .btn-filter-medium.active{
  color: black !important;
  background-color: #ffc107 !important;
  border-color: #ffc107 !important;
}
.btn-filter-medium:not(active){
  color: #ffc107 !important;
}
.btn-filter-hard:active, .btn-filter-hard.active{
  color: black !important;
  background-color: #dc3545 !important;
  border-color: #dc3545 !important;
}
.btn-filter-hard:not(active){
  color: #dc3545 !important;
}
.btn-filter-onlynew:active, .btn-filter-onlynew.active{
  color: black !important;
  background-color: #0dcaf0 !important;
  border-color: #0dcaf0 !important;
}
.btn-filter-onlynew:not(active){
  color: #0dcaf0 !important;
}
</style>

</head>
<body>

<header class="container">
    <div class="m-2 mb-4 text-center">
        <img src="images/ukulele-krakow.PNG" class="img-fluid" alt="Krakow Ukulele" width="200">
</header>

<div class="container">
<div class="row justify-content-center">
    
    <div id="list" class="col-lg-8 col-md-10 col-sm-12 my-3"> <!-- zachowania kontenerów dla różnych typów ekranów + margin-->

        <h4 class="semi-bold">Songbook</h4>
        <div class="row row-cols-2">
            <div class="col-md-6">
                <div>
                    <h6 class="custom-text-h5">Filter</h6>
                    <form id="filter-form">
						<div class="btn-group-vertical">
							<button type="button" name="Easy" class="toggle-button btn btn-filter-easy filter-button">Easy</button>
							<button type="button" name="Medium" class="toggle-button btn btn-filter-medium filter-button">Medium</button>
							<button type="button" name="Hard" class="toggle-button btn btn-filter-hard filter-button">Hard</button>
							<button type="button" name="New" class="toggle-button btn btn-filter-onlynew filter-button">🔥 New only</button>
						</div>
					</form>
                </div>
            </div>
			<!--<div class="col-md-1">
			</div>-->
            <div class="col-md-6 d-flex justify-content-end">
                <div>
                    <h6 class="custom-text-h5">Sort by</h6>
						<div class="btn-group-vertical">
							<button type="button" id="sortByTitle" class="toggle-button btn btn-outline-primary">  Titles  </button>
							<button type="button" id="sortByArtist" class="toggle-button btn btn-outline-primary"> Artists </button>
						</div>
						<div id="virtual-click-area" style="display: none; border: 2px solid red;"></div>
                </div>
            </div>
			
        </div>
		<!-- <div id="infoBox" style="position: fixed; right: 20px; top: 20px; border: 1px solid black; padding: 10px;">
			<p id="sorting method" style="font-size: xx-small;"></p>
		</div> 
		Robocze elementy do sprawdzania trybu sortowania 
		-->
		<!--<p id="sorting method"></p>-->
		
		
        <div class="mt-2">
			<h6>Songs</h6>
			<ul id="songs">
				{% for song in songs %}
					<li>
						<a href="{{song.html_name}}.html" name="{{song.Number}}">
						{{song.Number}} - {{song.Title}} - 
						</a>
						<small>
							<em> {{song.Artist}} -	</em> 
						</small>
						<span class="text-{{song.l_tr}}" >
							<small><b>{{song.Level}}</b></small>
						</span>
					</li>
				{% endfor %}
			</ul>
		</div>
       
    </div>

    <hr/>
			
    <div class="m-2 my-4 text-center">
        <img src="/images/qrcode.png" class="img-fluid" alt="QR Code" width="200">
    </div>
	<!--<div class="m-2 my-4 text-center"><li><a href="archive/archive.html">Archiwum</a></li>
	<li><a href="new/test.html">Test</a></li>
	</div>-->


</div>
</div>


<script> // Filtry poziomu
	document.addEventListener('DOMContentLoaded', () => {
		setupFilterButtons();
		setupSortingButtons();
	});

	function setupFilterButtons(){
		const filterButtons = document.querySelectorAll('.filter-button');
		const savedState = JSON.parse(sessionStorage.getItem('buttonState'));
		const songsList = document.getElementById('songs'); // ID listy piosenek
		console.log('Zachowane stany przyciskow: ', savedState); 
		if (savedState === null) {//sprawdza czy ma zapamiętane stany z tej sesji
			// Jesli savedState jest null, oznacz wszystkie przyciski jako aktywne
			filterButtons.forEach(button => {
				if (button.name !== 'New') {
					button.classList.add('active');
				}
			});
		} else {
			// W przeciwnym razie odczytaj stan przyciskow z sessionStorage
			filterButtons.forEach(button => { 
				if (button.name !== 'New') { //zapamiętujemy stan tylko dla leveli - dla New nie chcę
					if (savedState.includes(button.name)) {
						button.classList.add('active');
					}
				}
			});
		}
		filterSongs(); //odpala filtrowanie z uzględnieniem setupu przycisków
		filterButtons.forEach(button => {
			// Dla przyciskow wszystkich bez wyjatku
			button.addEventListener('touchend', () => { //nasłuchiwacz dotknięcia na urządzeniach dotykowych
			    changeFilterButtonState(button);
			});
			button.addEventListener('click', () => { //kliknięcia myszką
				changeFilterButtonState(button);
			});
		});
		filterButtons.forEach(button => {
			console.log(`Przycisk "${button.name}" jest ${button.classList.contains('active') ? 'aktywny' : 'nieaktywny'}`);
		});
		function changeFilterButtonState(button){
				event.preventDefault(); //blokada zachowania domyślnego aby móc wykonać swoje akcje
				button.classList.toggle('active'); //zmiana klasy 
				console.log('zmiana stany przyciskow: ', button.name);
				filterSongs(); //odpalenie filtrowania
				saveButtonState(); //zapamiętanie stanu
				// document.getElementById('virtual-click-area').click();
		}
		function saveButtonState() {
			const activeButtons = Array.from(filterButtons).filter(btn => btn.classList.contains('active'));
			sessionStorage.setItem('buttonState', JSON.stringify(activeButtons.map(btn => btn.name)));
		}
		function filterSongs() { //filtrowanie własciwe
			const activeButtons = document.querySelectorAll('.toggle-button.active'); //spr które aktywne
			console.log("Aktywne przyciski: ", activeButtons);
			const allSongs = songsList.querySelectorAll('li'); // wrzuca liste piosenek do zmiennej

			allSongs.forEach(song => {
				const level = song.querySelector('span small b').textContent; //level w liscie danych jest w takim selektorze
				var shouldDisplay = Array.from(activeButtons).some(btn => btn.name === level); // spr czy kótryś z aktywnych przycisków ma taką nazwę jak level danej piosenki
				song.style.display = shouldDisplay ? 'block' : 'none'; //jeśli tak to block=widoczna a none nie
				activeButtons.forEach(button => {
					if (button.name === 'New') {
						const title = song.querySelector('a').textContent;
						shouldDisplay = title.includes('🔥'); // piosenka jest nowa jesli ma w nazwie fajer
						if (song.style.display === 'block'){ //czyli jeśli piosenka jest nowa i już jest wyświetlona (odfiltrowane) to wyświetlaj, 
							song.style.display = shouldDisplay ? 'block' : 'none';}
					}
				});
			});
		}
	}

	function setupSortingButtons(){
		const songsList = document.getElementById('songs'); // ID twojej listy piosenek
        const sortByTitleButton = document.getElementById('sortByTitle');
        const sortByArtistButton = document.getElementById('sortByArtist');
		const myArtElements = document.querySelectorAll('.my-art'); // Znajdź wszystkie elementy o klasie "my-art"
		const myLevElements = document.querySelectorAll('.my-lev'); // Znajdź wszystkie elementy o klasie "my-lev"
		//sortByTitleButton.checked = true; // Zaznacz pole wyboru
		// Wylacz przycisk "Sort by Artist" na poczatku
           	// sortByArtistButton.classList.remove('active');
		sortByTitleButton.classList.add('active');// - domyślne sortowanie po tytułach

        sortByTitleButton.addEventListener('click', () => { // jeśli kliknąć title:
            sortByTitle();
            sortByArtistButton.classList.remove('active'); // Wylacz drugi przycisk
            sortByTitleButton.classList.add('active'); // Zaznacz pierwszy przycisk
			var s_variant=true;
			// Aktualizuj wartości w infoBox ROBOCZO
			//document.getElementById('sorting method').textContent = 'sort by title: ' + s_variant;
        });

        sortByArtistButton.addEventListener('click', () => {
            sortByArtist();
            sortByTitleButton.classList.remove('active'); // Wy艂膮cz pierwszy przycisk
            sortByArtistButton.classList.add('active'); // Zaznacz drugi przycisk
			s_variant=false;
			// Aktualizuj wartości w infoBox ROBOCZO
			//document.getElementById('sorting method').textContent = 'sort by title: ' + s_variant;
        });
		
        function sortByTitle() {
			const sortedSongs = Array.from(songsList.querySelectorAll('li')) // pobieram listę piosenek
            .sort((a, b) => {
				// Pobierz nazwe z atrybutu href
				var nameA = a.querySelector('a').getAttribute('href');
				var nameB = b.querySelector('a').getAttribute('href');
				nameA = nameA.replace(/^🔥/i, '');//ignor ikon
				nameB = nameB.replace(/^🔥/i, '');
				nameA = nameA.replace(/^🎂/i, '');
				nameB = nameB.replace(/^🎂/i, '');
				// Porównaj nazwy
				return nameA.localeCompare(nameB);

				
            });
			songsList.innerHTML = ''; // Wyczysc liste
			sortedSongs.forEach(song => songsList.appendChild(song));
			
			var allLiElements = document.querySelectorAll('li'); // Pobierz wszystkie elementy <li>. Uwaga! nie może istnieć inny element typu <li>
			allLiElements.forEach(function (myLi) {
				var EmElement = myLi.querySelector('em'); 
				var anchorElement = myLi.querySelector('a'); // Pobierz element <a>
				myLi.insertBefore(anchorElement, EmElement); // Przenieś element small em przed elementem <a>
			});
        }

        function sortByArtist() {
			const sortedSongs = Array.from(songsList.querySelectorAll('li'))
				.sort((a, b) => {
					var artistA = a.querySelector('em').textContent;
					artistA = artistA.replace(/^\s*The\s+/i, ''); //usuwanie śmieci napotrzeby sotowania
					artistA = artistA.replace(/^\s+/, ''); 
					//console.log('artistA : ', artistA);
					
					var artistB = b.querySelector('em').textContent;
					artistB = artistB.replace(/^\s*The\s+/i, '');
					artistB = artistB.replace(/^\s+/, '');
					//console.log('artistB : ', artistB);
					

					return artistA.localeCompare(artistB, 'en', { sensitivity: 'base' });
				});
			songsList.innerHTML = ''; // Wyczysc liste
			sortedSongs.forEach(song => songsList.appendChild(song));
			
			var allLiElements = document.querySelectorAll('li'); // Pobierz wszystkie elementy <li>
			allLiElements.forEach(function(myLi, index) {
				var SmallEmElement = myLi.querySelector('em');
				//console.log(`Iteracja ${index}:`, SmallEmElement);
				//console.log(`Iteracja ${index}:`, myLi.querySelector('a'));

				myLi.insertBefore(SmallEmElement, myLi.querySelector('a')); // przestawianie szyku
			});
		}
	}
</script>
</body>
</html>
